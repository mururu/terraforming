<% iam_roles.each do |role| -%>
resource "aws_iam_role" "<%= module_name_of(role) %>" {
  name = "<%= role.role_name %>"
  path = "<%= role.path %>"

  assume_role_policy = <<POLICY
<%= prettify_policy(role.assume_role_policy_document, unescape: true) %>
POLICY
}
<% iam_role_policies(role).each do |policy| -%>

resource "aws_iam_role_policy" "<%= unique_name(policy) %>" {
  name = "<%= policy.policy_name %>"
  role = "${aws_iam_role.<%= module_name_of(role) %>.name}"

  policy = <<POLICY
<%= prettify_policy(policy.policy_document, unescape: true) %>
POLICY
}
<% end -%>
<% iam_policy_attachments_of(role).each do |policy| -%>

resource "aws_iam_policy_attachment" "<%= attachment_name_of(policy) %>" {
  role       = "${aws_iam_role.<%= module_name_of(role) %>.name}"
  policy_arn = "${aws_iam_policy.<%= policy_name_of(policy) %>.arn}"
}
<% end -%>

<% end -%>
